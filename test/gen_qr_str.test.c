#include <criterion/criterion.h>
#include <qrencode.h>
#include "../src/gen_qr_str.h"

QRcode *qr_symbol;

void setup(void)
{
    qr_symbol = QRcode_encodeString("test", 0, QR_ECLEVEL_L, QR_MODE_8, 1);
}

TestSuite(expandable_string, .init = setup);

Test(gen_qr, gen_qr_margin)
{
    QRcode *qr_symbol = QRcode_encodeString("test", 0, QR_ECLEVEL_L, QR_MODE_8, 1);

    char *str = gen_qr_margin(qr_symbol);

    cr_expect(strcmp(str, "██████████████████████████████████████████████\n") == 0, "function should generate the qr code margin for the string 'test'");
}

Test(gen_qr, gen_qr_body)
{
    QRcode *qr_symbol = QRcode_encodeString("test", 0, QR_ECLEVEL_L, QR_MODE_8, 1);

    char *str = gen_qr_body(qr_symbol);

    cr_expect(strcmp(str, "██              ██████  ██  ██              ██\n██  ██████████  ██████████  ██  ██████████  ██\n██  ██      ██  ██  ██  ██████  ██      ██  ██\n██  ██      ██  ██████████  ██  ██      ██  ██\n██  ██      ██  ████  ██    ██  ██      ██  ██\n██  ██████████  ████      ████  ██████████  ██\n██              ██  ██  ██  ██              ██\n██████████████████  ██  ██████████████████████\n██      ██          ██  ██      ██████  ██████\n████  ██    ██████████    ██  ██  ██████    ██\n██████  ██████  ████████  ██      ██        ██\n██  ██  ██    ██      ██      ██    ████  ████\n████  ██  ████  ██  ████  ██      ██  ██    ██\n██████████████████      ██████  ████  ████  ██\n██              ██  ██  ██  ██████    ██    ██\n██  ██████████  ██    ████████  ████████  ████\n██  ██      ██  ██    ████  ██  ██    ██    ██\n██  ██      ██  ██████    ██  ██  ██████  ████\n██  ██      ██  ██    ██  ██      ████  ██  ██\n██  ██████████  ██  ██        ██      ██  ████\n██              ██    ██  ██      ████      ██"));
}

Test(gen_qr, gen_qr_string)
{
    char *str = gen_qr_str("test");

    cr_expect(strcmp(str, "██████████████████████████████████████████████\n██              ██████  ██  ██              ██\n██  ██████████  ██████████  ██  ██████████  ██\n██  ██      ██  ██  ██  ██████  ██      ██  ██\n██  ██      ██  ██████████  ██  ██      ██  ██\n██  ██      ██  ████  ██    ██  ██      ██  ██\n██  ██████████  ████      ████  ██████████  ██\n██              ██  ██  ██  ██              ██\n██████████████████  ██  ██████████████████████\n██      ██          ██  ██      ██████  ██████\n████  ██    ██████████    ██  ██  ██████    ██\n██████  ██████  ████████  ██      ██        ██\n██  ██  ██    ██      ██      ██    ████  ████\n████  ██  ████  ██  ████  ██      ██  ██    ██\n██████████████████      ██████  ████  ████  ██\n██              ██  ██  ██  ██████    ██    ██\n██  ██████████  ██    ████████  ████████  ████\n██  ██      ██  ██    ████  ██  ██    ██    ██\n██  ██      ██  ██████    ██  ██  ██████  ████\n██  ██      ██  ██    ██  ██      ████  ██  ██\n██  ██████████  ██  ██        ██      ██  ████\n██              ██    ██  ██      ████      ██\n██████████████████████████████████████████████"));
}